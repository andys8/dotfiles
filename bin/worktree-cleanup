#!/usr/bin/env bash

set -e

force_delete=""
for arg in "$@"; do
  case $arg in
    -f|--force) force_delete="-D" ;;
  esac
done

branches=$(wt list --format=json | jq -r '.[] | select(.is_main == false and .kind == "worktree") | .branch')

if [ -z "$branches" ]; then
  echo "No worktrees to remove"
  exit 0
fi

echo "Removing worktrees:"
echo "$branches" | sed 's/^/  /'
[ -n "$force_delete" ] && echo "(force-deleting unmerged branches)"
echo ""

read -p "Remove all? (y/N) " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
  echo "Cancelled"
  exit 0
fi

wt remove --force --yes $force_delete $branches
